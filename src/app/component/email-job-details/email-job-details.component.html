<div *ngIf="emailJob; else loading" class="email-job-details">
  <h1 class="title">Email Job Details</h1>

  <!-- Display success message after deletion -->
  <div *ngIf="successMessage" class="success-message">
    <p>{{ successMessage }}</p>
  </div>

  <div class="details-card">
    <p><strong>UUID:</strong> {{ emailJob.uuid }}</p>
    <p><strong>Start Date:</strong> {{ emailJob.startDate | date: 'short' }}</p>
    <p><strong>End Date:</strong> {{ emailJob.endDate ? (emailJob.endDate | date: 'short') : 'N/A' }}</p>
    <p><strong>Status:</strong> {{ emailJob.enabled ? 'Enabled' : 'Disabled' }}</p>
    <p><strong>Email Template UUID:</strong> {{ emailJob.emailTemplate.uuid }}</p>
    <p><strong>Sender UUID:</strong> {{ emailJob.sender.uuid }}</p>
    <p><strong>Receivers:</strong> {{ emailJob.receivers }}</p>
    <p><strong>Frequency:</strong> {{ getFrequencyDisplay(emailJob.frequency) }}</p>

    <!-- View Occurrences Button -->
    <div class="view-button-container">
      <button class="view-button" (click)="toggleOccurrencesDetails()">
        {{ showOccurrences ? 'Cancel Occurrence' : 'View Occurrence Details' }}
      </button>
    </div>

    <div *ngIf="showOccurrences">
      <div *ngIf="occurrences && occurrences.length > 0; else noOccurrencesMessage">
        <h2 class="subheading">Occurrences</h2>
        <ul>
          <li *ngFor="let occurrence of occurrences">
            <p><strong>Date:</strong> {{ occurrence.createdOn | date: 'short' }}</p>
            <p><strong>Status:</strong>
              <span [ngClass]="{
                'status': true,
                'success': occurrence.status === StatusEnum.SUCCESS,
                'failed': occurrence.status !== StatusEnum.SUCCESS
              }">
                {{ occurrence.status }}
              </span>
            </p>
            <p *ngIf="occurrence.status !== StatusEnum.SUCCESS && occurrence.errorDescription">
              <strong>Error Description:</strong> {{ occurrence.errorDescription }}
            </p>
          </li>
        </ul>
      </div>
      <ng-template #noOccurrencesMessage>
        <p>No occurrences available.</p>
      </ng-template>
    </div>
  </div>

  <!-- Button Section for Delete and Back -->
  <div class="button-container">
    <button class="back-button" (click)="backToDashboard()">Back to Dashboard</button>
    <button class="delete-button" (click)="toggleDeleteConfirmation()">Delete Email Job</button>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div *ngIf="showDeleteConfirmation" class="delete-confirmation-modal">
  <div class="modal-content">
    <h3>Are you sure you want to delete this email job?</h3>
    <p>This action cannot be undone.</p>
    <div class="modal-buttons">
      <button class="confirm-button" (click)="confirmDelete()">Yes, Delete</button>
      <button class="cancel-button" (click)="cancelDelete()">Cancel</button>
    </div>
  </div>
</div>

<!-- Loading Template -->
<ng-template #loading>
  <div class="loading">
    <p>Loading email job details...</p>
  </div>
</ng-template>
